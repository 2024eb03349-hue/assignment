#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/wait.h>
#include <sys/types.h>

#define NUM_CHILDREN 5

int main() {
    pid_t pid;
    int i, status;
    
    printf("Parent process PID: %d\n", getpid());
    
    // Create multiple child processes
    for (i = 0; i < NUM_CHILDREN; i++) {
        pid = fork();
        
        if (pid < 0) {
            // Fork failed
            perror("fork failed");
            exit(1);
        } else if (pid == 0) {
            // Child process
            printf("Child %d created with PID: %d\n", i+1, getpid());
            sleep(2 + i); // Different sleep times for each child
            printf("Child %d (PID: %d) exiting\n", i+1, getpid());
            exit(0);
        }
        // Parent continues to create more children
    }
    
    // Parent waits for all children to prevent zombies
    printf("\nParent waiting for children to terminate...\n");
    
    for (i = 0; i < NUM_CHILDREN; i++) {
        pid = wait(&status);
        
        if (pid == -1) {
            perror("wait error");
        } else {
            if (WIFEXITED(status)) {
                printf("Parent: Cleaned up child PID %d with exit status %d\n", 
                       pid, WEXITSTATUS(status));
            } else if (WIFSIGNALED(status)) {
                printf("Parent: Child PID %d terminated by signal %d\n", 
                       pid, WTERMSIG(status));
            }
        }
    }
    
    printf("\nAll children have been cleaned up. No zombies remain.\n");
    return 0;
}
